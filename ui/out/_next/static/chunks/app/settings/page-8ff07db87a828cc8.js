(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{834:(e,s,n)=>{"use strict";n.d(s,{T:()=>t});var a=n(3422);n(4398);var i=n(9183);function t(e){let{className:s,...n}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...n})}},2739:(e,s,n)=>{Promise.resolve().then(n.bind(n,4961))},4961:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>_});var a=n(3422),i=n(4398),t=n(6839),r=n(3234),l=n(3831),c=n(2738),d=n(268),o=n(3130),h=n(3648),u=n(8561),x=n(9675),m=n(246),j=n(4717);function p(){let{config:e,updateField:s,saveConfig:n,isSyncing:t}=function(){let[e,s]=(0,i.useState)({endpoint:"",apiKey:"",enabled:!1}),[n,a]=(0,i.useState)(!1),[t,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{s(r.s.getServerConfig()),a(!0);try{c(!0);let e=await r.s.loadServerConfigFromBackend();e&&s(e)}catch(e){console.error("Error loading configuration from backend:",e)}finally{c(!1)}})()},[]);let d=(0,i.useCallback)(async e=>{r.s.saveServerConfig(e),s(e);try{c(!0),await r.s.saveServerConfigToBackend(e)||l.oR.warning("Configuration saved locally, but failed to sync with server")}catch(e){console.error("Error saving configuration to backend:",e),l.oR.error("Failed to sync configuration with server")}finally{c(!1)}},[]),o=(0,i.useCallback)((s,n)=>{d({...e,[s]:n})},[e,d]),h=(0,i.useCallback)(()=>{d({...e,enabled:!e.enabled})},[e,d]);return{config:e,isLoaded:n,isSyncing:t,saveConfig:d,updateField:o,toggleEnabled:h,isConfigValid:(0,i.useCallback)(()=>r.s.isServerConfigValid(),[])}}(),[p,v]=(0,i.useState)("idle"),g=(e,n)=>{s(e,n),v("idle")},f=async()=>{if(e.endpoint){v("testing");try{await r.s.testConnection(e)?(v("success"),l.oR.success("Connection successful!")):(v("error"),l.oR.error("Connection failed. Please check your settings."))}catch(e){console.error("Connection test error:",e),v("error"),l.oR.error("Connection failed. Please check your settings.")}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:"External Server Configuration"}),t&&(0,a.jsxs)(u.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 animate-spin text-blue-500"}),"Syncing..."]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c.ZB,{children:"Request Forwarding Settings"}),(0,a.jsx)(c.BT,{children:"Configure external server endpoint and authentication for API request forwarding"})]}),e.enabled&&("idle"===p?(0,a.jsxs)(u.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 text-yellow-500"}),"Not tested"]}):"testing"===p?(0,a.jsxs)(u.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 animate-pulse text-blue-500"}),"Testing..."]}):"success"===p?(0,a.jsxs)(u.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 text-green-500"}),"Connected"]}):(0,a.jsxs)(u.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 text-red-500"}),"Failed"]}))]})}),(0,a.jsx)(c.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"server-endpoint",children:"Server Endpoint URL"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.p,{id:"server-endpoint",placeholder:"https://ecash.routstr.info",value:e.endpoint,onChange:e=>g("endpoint",e.target.value),className:"pr-24"}),(0,a.jsx)(h.$,{type:"button",variant:"ghost",size:"sm",className:"absolute top-0 right-0 h-full px-3 py-2 text-xs",onClick:()=>g("endpoint","https://ecash.routstr.info"),children:"Use Default"})]})]})}),(0,a.jsxs)(c.wL,{className:"flex justify-between",children:[(0,a.jsx)(h.$,{variant:"outline",onClick:f,disabled:!e.endpoint||"testing"===p,children:"Test Connection"}),(0,a.jsx)(h.$,{onClick:()=>{try{n(e),l.oR.success("Server configuration saved successfully")}catch(e){l.oR.error("Failed to save configuration"),console.error("Configuration save error:",e)}},children:"Save Configuration"})]})]})]})}var v=n(9119),g=n(834),f=n(9442),N=n(989),y=n(7137),b=n(3728),C=n(7829);function w(){let[e,s]=(0,i.useState)({}),[n,t]=(0,i.useState)(!0),[r,u]=(0,i.useState)(!1),[m,j]=(0,i.useState)(""),[p,w]=(0,i.useState)(!1),[S,k]=(0,i.useState)("");(0,i.useEffect)(()=>{R()},[]);let R=async()=>{try{t(!0),j("");let e=await v.zQ.getSettings();s(e)}catch(s){let e=s instanceof Error?s.message:"Failed to load settings";j(e),l.oR.error(e)}finally{t(!1)}},_=async()=>{try{u(!0),j("");let n=await v.zQ.updateSettings(e);s(n),l.oR.success("Settings saved successfully")}catch(s){let e=s instanceof Error?s.message:"Failed to save settings";j(e),l.oR.error(e)}finally{u(!1)}},A=(e,n)=>{s(s=>({...s,[e]:n}))},E=e=>{s(s=>{var n;return{...s,cashu_mints:(null==(n=s.cashu_mints)?void 0:n.filter((s,n)=>n!==e))||[]}})},F=(s,n,i)=>{let t=e[s]||"";return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:s,children:n}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.p,{id:s,type:p?"text":"password",value:p?t:t?"••••••••":"",onChange:e=>A(s,e.target.value),placeholder:i,className:"flex-1"}),(0,a.jsx)(h.$,{type:"button",variant:"outline",size:"icon",onClick:()=>w(!p),children:p?(0,a.jsx)(N.A,{className:"h-4 w-4"}):(0,a.jsx)(y.A,{className:"h-4 w-4"})})]})]})};return n?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading settings..."})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:"Admin Settings"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Configure your Routstr node settings"})]}),m&&(0,a.jsxs)(f.Fc,{variant:"destructive",className:"mb-6",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)(f.TN,{children:m})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Basic Information"}),(0,a.jsx)(c.BT,{children:"Configure the basic node information and branding"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"name",children:"Node Name"}),(0,a.jsx)(d.p,{id:"name",value:e.name||"",onChange:e=>A("name",e.target.value),placeholder:"ARoutstrNode"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(g.T,{id:"description",value:e.description||"",onChange:e=>A("description",e.target.value),placeholder:"A Routstr Node",rows:3})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"http_url",children:"HTTP URL"}),(0,a.jsx)(d.p,{id:"http_url",value:e.http_url||"",onChange:e=>A("http_url",e.target.value),placeholder:"https://your-node.com"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"onion_url",children:"Onion URL (Optional)"}),(0,a.jsx)(d.p,{id:"onion_url",value:e.onion_url||"",onChange:e=>A("onion_url",e.target.value),placeholder:"http://your-node.onion"})]})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Nostr Configuration"}),(0,a.jsx)(c.BT,{children:"Configure Nostr public and private keys"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"npub",children:"Public Key (npub)"}),(0,a.jsx)(d.p,{id:"npub",value:e.npub||"",onChange:e=>A("npub",e.target.value),placeholder:"npub1..."})]}),F("nsec","Private Key (nsec)","nsec1...")]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Security Settings"}),(0,a.jsx)(c.BT,{children:"Configure authentication and API access"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[F("admin_password","Admin Password","Enter admin password"),F("upstream_api_key","Upstream API Key","Enter API key")]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Cashu Mints"}),(0,a.jsx)(c.BT,{children:"Configure Cashu mint endpoints for payments"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"newMint",children:"Add Mint URL"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.p,{id:"newMint",value:S,onChange:e=>k(e.target.value),placeholder:"https://mint.example.com"}),(0,a.jsx)(h.$,{onClick:()=>{S.trim()&&(s(e=>({...e,cashu_mints:[...e.cashu_mints||[],S.trim()]})),k(""))},disabled:!S.trim(),children:"Add Mint"})]})]}),e.cashu_mints&&e.cashu_mints.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:"Configured Mints"}),(0,a.jsx)("div",{className:"space-y-2",children:e.cashu_mints.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded",children:[(0,a.jsx)("span",{className:"flex-1 text-sm",children:e}),(0,a.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>E(s),children:"Remove"})]},s))})]})]})]})]}),(0,a.jsx)(c.Zp,{className:"mt-6",children:(0,a.jsxs)(c.wL,{className:"flex justify-between",children:[(0,a.jsxs)(h.$,{variant:"outline",onClick:R,disabled:n||r,children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Reload"]}),(0,a.jsxs)(h.$,{onClick:_,disabled:n||r,children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"}),r?"Saving...":"Save Settings"]})]})})]})}var S=n(4756),k=n(7569),R=n(953);function _(){return(0,a.jsxs)(R.SidebarProvider,{children:[(0,a.jsx)(k.AppSidebar,{variant:"inset"}),(0,a.jsxs)(R.SidebarInset,{children:[(0,a.jsx)(S.SiteHeader,{}),(0,a.jsx)("div",{className:"flex flex-1 flex-col",children:(0,a.jsxs)("div",{className:"@container/main flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Settings"})}),(0,a.jsxs)(t.tU,{defaultValue:"admin",className:"w-full",children:[(0,a.jsx)(t.j7,{className:"mb-4",children:(0,a.jsx)(t.Xi,{value:"admin",children:"Admin Settings"})}),(0,a.jsx)(t.av,{value:"server",children:(0,a.jsx)(p,{})}),(0,a.jsx)(t.av,{value:"admin",children:(0,a.jsx)(w,{})})]})]})})]}),(0,a.jsx)(l.l$,{})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[363,222,230,978,651,236,255,945,497,358],()=>s(2739)),_N_E=e.O()}]);