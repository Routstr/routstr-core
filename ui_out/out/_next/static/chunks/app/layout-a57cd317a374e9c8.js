(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3234:(e,t,r)=>{"use strict";r.d(t,{s:()=>o});var a=r(9945),n=r(5842);a.Ik({endpoint:a.Yj().url().or(a.eu("")),apiKey:a.Yj(),enabled:a.zM()});class o{static getServerConfig(){return{endpoint:localStorage.getItem("server_endpoint")||"",apiKey:localStorage.getItem("server_api_key")||"",enabled:"true"===localStorage.getItem("server_enabled")}}static saveServerConfig(e){localStorage.setItem("server_endpoint",e.endpoint),localStorage.setItem("server_api_key",e.apiKey),localStorage.setItem("server_enabled",e.enabled.toString())}static isServerConfigValid(){let e=this.getServerConfig();return e.enabled&&!!e.endpoint&&!!e.apiKey}static getLocalBaseUrl(){let e="http://127.0.0.1:8000";return(console.log(e),e)?e:""}static isProduction(){return!0}static getBaseUrl(){let e=this.getServerConfig();return e.enabled&&e.endpoint?e.endpoint:this.getLocalBaseUrl()}static getAuthHeaders(){let e={"Content-Type":"application/json"};try{{let t=localStorage.getItem("admin_token"),r=localStorage.getItem("admin_token_expiry");if(t&&r){let a=parseInt(r,10);if(Date.now()<a)return e.Authorization="Bearer ".concat(t),e;localStorage.removeItem("admin_token"),localStorage.removeItem("admin_token_expiry")}}}catch(e){console.warn("Error accessing localStorage:",e)}let t="dummy-admin-key-12345";return t&&(e.Authorization="Bearer ".concat(t)),e}static isTokenValid(){let e=localStorage.getItem("admin_token"),t=localStorage.getItem("admin_token_expiry");if(!e||!t)return!1;let r=parseInt(t,10);return Date.now()<r}static clearToken(){localStorage.removeItem("admin_token"),localStorage.removeItem("admin_token_expiry")}static setToken(e,t){let r=Date.now()+1e3*t;localStorage.setItem("admin_token",e),localStorage.setItem("admin_token_expiry",String(r))}static async testConnection(e){if(!e.endpoint)return!1;try{let t=await n.A.get("".concat(e.endpoint,"/health"),{headers:{"Content-Type":"application/json"},timeout:1e3});return 200===t.status}catch(e){return console.error("Server connection test failed:",e),!1}}static async saveServerConfigToBackend(e){try{this.saveServerConfig(e);let t=this.getLocalBaseUrl(),r={endpoint:e.endpoint,api_key:e.apiKey};return await n.A.post("".concat(t,"/api/server-config"),r,{headers:{"Content-Type":"application/json"}}),!0}catch(e){return console.error("Failed to save configuration to backend:",e),!1}}static async loadServerConfigFromBackend(){try{let e=this.getLocalBaseUrl(),t=await n.A.get("".concat(e,"/api/server-config"),{headers:{"Content-Type":"application/json"}});if(t&&t.data){let e={endpoint:t.data.endpoint||"",apiKey:t.data.api_key||"",enabled:!!t.data.endpoint&&!!t.data.api_key};return this.saveServerConfig(e),e}return null}catch(e){return console.error("Failed to load configuration from backend:",e),null}}static async requestNewApiKey(e){try{let t=this.getLocalBaseUrl(),r=await n.A.post("".concat(t,"/api/server-config/new-key"),{reason:e},{headers:{"Content-Type":"application/json",...this.getAuthHeaders()}});if(r.data&&r.data.api_key)return r.data.api_key;throw Error("No API key received from server")}catch(e){throw console.error("Failed to request new API key:",e),e}}}},7075:(e,t,r)=>{Promise.resolve().then(r.bind(r,7895)),Promise.resolve().then(r.bind(r,8748)),Promise.resolve().then(r.t.bind(r,8368,23)),Promise.resolve().then(r.t.bind(r,7248,23)),Promise.resolve().then(r.t.bind(r,8770,23))},7895:(e,t,r)=>{"use strict";r.d(t,{Providers:()=>f});var a=r(3422),n=r(5235),o=r(100),s=r(6126),i=r(4398),c=r(3831),l=r(7916);class u{static async listUsers(e){try{let t={};return e&&(t.organization_id=e),await l.apiClient.get("/api/users",t)}catch(e){throw console.error("Error fetching users:",e),e}}static async getUser(e){try{return await l.apiClient.get("/api/users/".concat(e))}catch(t){throw console.error("Error fetching user ".concat(e,":"),t),t}}static async createUser(e){try{return await l.apiClient.post("/api/users",e)}catch(e){throw console.error("Error creating user:",e),e}}static async updateUser(e,t){try{return await l.apiClient.put("/api/users/".concat(e),t)}catch(t){throw console.error("Error updating user ".concat(e,":"),t),t}}static async deleteUser(e){try{await l.apiClient.delete("/api/users/".concat(e))}catch(t){throw console.error("Error deleting user ".concat(e,":"),t),t}}}let d=(0,i.createContext)({user:null,isLoading:!1,error:null,isAuthenticated:!1,nostrPublicKey:null,signin:async()=>{},signout:()=>{},connectNostr:async()=>null});function h(e){let{children:t}=e,[r,n]=(0,i.useState)(null),[o,s]=(0,i.useState)(!0),[c,l]=(0,i.useState)(null),[h,g]=(0,i.useState)(null),p=async()=>{try{if(!("nostr"in window))return console.error("Nostr extension not found"),null;{let e=await window.nostr.getPublicKey();return g(e),localStorage.setItem("nostr_public_key",e),e}}catch(e){return console.error("Error connecting to Nostr:",e),null}},y=async()=>{s(!0),l(null);try{let e=await u.getUser("1");if(!e)throw Error("Admin user not found");n(e),localStorage.setItem("auth_user",JSON.stringify(e)),h||await p()}catch(e){throw l(e instanceof Error?e:Error("Sign in failed")),e}finally{s(!1)}};return(0,a.jsx)(d.Provider,{value:{user:r,isLoading:o,error:c,isAuthenticated:!0,nostrPublicKey:h,signin:y,signout:()=>{n(null),localStorage.removeItem("auth_user")},connectNostr:p},children:t})}var g=r(1064),p=r(3234);function y(e){let{children:t}=e,r=(0,g.useRouter)(),n=(0,g.usePathname)();return(0,i.useEffect)(()=>{["/login","/_register","/unauthorized"].some(e=>n.startsWith(e))||p.s.isTokenValid()||r.push("/login")},[r,n]),(0,a.jsx)(a.Fragment,{children:t})}var m=r(1262);function w(e){let{children:t,...r}=e;return(0,a.jsx)(m.N,{...r,children:t})}function f(e){let{children:t}=e,[r]=(0,i.useState)(()=>new n.E({defaultOptions:{queries:{staleTime:3e5,refetchOnWindowFocus:!1,retry:2}}}));return(0,a.jsx)(o.Ht,{client:r,children:(0,a.jsxs)(w,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:[(0,a.jsx)(h,{children:(0,a.jsxs)(y,{children:[t,(0,a.jsx)(c.l$,{position:"top-right"})]})}),(0,a.jsx)(s.E,{initialIsOpen:!1})]})})}},7916:(e,t,r)=>{"use strict";r.d(t,{apiClient:()=>s});var a=r(5842),n=r(3234);class o{getBaseUrl(){return n.s.getLocalBaseUrl()}getHeaders(){return n.s.getAuthHeaders()}handleAuthError(e){if(a.A.isAxiosError(e)){var t,r;((null==(t=e.response)?void 0:t.status)===401||(null==(r=e.response)?void 0:r.status)===403)&&(n.s.clearToken(),window.location.href="/login")}}async get(e,t){let r={headers:this.getHeaders(),params:t,withCredentials:!1};try{return console.log("Making GET request to ".concat(this.getBaseUrl()).concat(e)),(await a.A.get("".concat(this.getBaseUrl()).concat(e),r)).data}catch(e){throw this.handleAuthError(e),e}}async post(e,t){let r={headers:this.getHeaders(),withCredentials:!1};try{return console.log("Making POST request to ".concat(this.getBaseUrl()).concat(e),t),(await a.A.post("".concat(this.getBaseUrl()).concat(e),t,r)).data}catch(t){throw this.handleAuthError(t),console.error("Error posting to ".concat(e,":"),t),t}}async put(e,t){let r={headers:this.getHeaders(),withCredentials:!1};try{return console.log("Making PUT request to ".concat(this.getBaseUrl()).concat(e),t),(await a.A.put("".concat(this.getBaseUrl()).concat(e),t,r)).data}catch(t){throw this.handleAuthError(t),console.error("Error updating ".concat(e,":"),t),t}}async patch(e,t){let r={headers:this.getHeaders(),withCredentials:!1};try{return console.log("Making PATCH request to ".concat(this.getBaseUrl()).concat(e),t),(await a.A.patch("".concat(this.getBaseUrl()).concat(e),t,r)).data}catch(t){throw this.handleAuthError(t),console.error("Error patching ".concat(e,":"),t),t}}async delete(e){let t={headers:this.getHeaders(),withCredentials:!1};try{return console.log("Making DELETE request to ".concat(this.getBaseUrl()).concat(e)),(await a.A.delete("".concat(this.getBaseUrl()).concat(e),t)).data}catch(t){throw this.handleAuthError(t),console.error("Error deleting from ".concat(e,":"),t),t}}}let s=new o},8748:(e,t,r)=>{"use strict";r.d(t,{SuppressHydrationWarning:()=>o});var a=r(3422),n=r(4398);function o(e){let{children:t}=e,[r,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{o(!0)},[]),r)?(0,a.jsx)(a.Fragment,{children:t}):null}},8770:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[699,273,363,29,375,945,497,358],()=>t(7075)),_N_E=e.O()}]);