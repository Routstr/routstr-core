(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{834:(e,s,r)=>{"use strict";r.d(s,{T:()=>n});var a=r(3422);r(4398);var t=r(9183);function n(e){let{className:s,...r}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,t.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r})}},2739:(e,s,r)=>{Promise.resolve().then(r.bind(r,4961))},4961:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>R});var a=r(3422),t=r(4398),n=r(6839),i=r(3234),l=r(3831),c=r(2738),o=r(268),d=r(3130),u=r(3648),x=r(8561),h=r(9675),p=r(246),m=r(4717);function g(){let{config:e,updateField:s,saveConfig:r,isSyncing:n}=function(){let[e,s]=(0,t.useState)({endpoint:"",apiKey:"",enabled:!1}),[r,a]=(0,t.useState)(!1),[n,c]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{s(i.s.getServerConfig()),a(!0);try{c(!0);let e=await i.s.loadServerConfigFromBackend();e&&s(e)}catch(e){console.error("Error loading configuration from backend:",e)}finally{c(!1)}})()},[]);let o=(0,t.useCallback)(async e=>{i.s.saveServerConfig(e),s(e);try{c(!0),await i.s.saveServerConfigToBackend(e)||l.oR.warning("Configuration saved locally, but failed to sync with server")}catch(e){console.error("Error saving configuration to backend:",e),l.oR.error("Failed to sync configuration with server")}finally{c(!1)}},[]),d=(0,t.useCallback)((s,r)=>{o({...e,[s]:r})},[e,o]),u=(0,t.useCallback)(()=>{o({...e,enabled:!e.enabled})},[e,o]);return{config:e,isLoaded:r,isSyncing:n,saveConfig:o,updateField:d,toggleEnabled:u,isConfigValid:(0,t.useCallback)(()=>i.s.isServerConfigValid(),[])}}(),[g,v]=(0,t.useState)("idle"),f=(e,r)=>{s(e,r),v("idle")},j=async()=>{if(e.endpoint){v("testing");try{await i.s.testConnection(e)?(v("success"),l.oR.success("Connection successful!")):(v("error"),l.oR.error("Connection failed. Please check your settings."))}catch(e){console.error("Connection test error:",e),v("error"),l.oR.error("Connection failed. Please check your settings.")}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:"External Server Configuration"}),n&&(0,a.jsxs)(x.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 animate-spin text-blue-500"}),"Syncing..."]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c.ZB,{children:"Request Forwarding Settings"}),(0,a.jsx)(c.BT,{children:"Configure external server endpoint and authentication for API request forwarding"})]}),e.enabled&&("idle"===g?(0,a.jsxs)(x.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 text-yellow-500"}),"Not tested"]}):"testing"===g?(0,a.jsxs)(x.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 animate-pulse text-blue-500"}),"Testing..."]}):"success"===g?(0,a.jsxs)(x.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-green-500"}),"Connected"]}):(0,a.jsxs)(x.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 text-red-500"}),"Failed"]}))]})}),(0,a.jsx)(c.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"server-endpoint",children:"Server Endpoint URL"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.p,{id:"server-endpoint",placeholder:"https://ecash.routstr.info",value:e.endpoint,onChange:e=>f("endpoint",e.target.value),className:"pr-24"}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"sm",className:"absolute top-0 right-0 h-full px-3 py-2 text-xs",onClick:()=>f("endpoint","https://ecash.routstr.info"),children:"Use Default"})]})]})}),(0,a.jsxs)(c.wL,{className:"flex justify-between",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:j,disabled:!e.endpoint||"testing"===g,children:"Test Connection"}),(0,a.jsx)(u.$,{onClick:()=>{try{r(e),l.oR.success("Server configuration saved successfully")}catch(e){l.oR.error("Failed to save configuration"),console.error("Configuration save error:",e)}},children:"Save Configuration"})]})]})]})}var v=r(9119),f=r(834),j=r(9442),w=r(989),b=r(7137),y=r(3728),N=r(7829);function C(){let[e,s]=(0,t.useState)({}),[n,i]=(0,t.useState)(!0),[x,p]=(0,t.useState)(!1),[m,g]=(0,t.useState)(""),[C,_]=(0,t.useState)(!1),[S,k]=(0,t.useState)(""),[R,F]=(0,t.useState)({current_password:"",new_password:"",confirm_password:""}),[A,E]=(0,t.useState)(""),[P,B]=(0,t.useState)(!1);(0,t.useEffect)(()=>{T()},[]);let T=async()=>{try{i(!0),g("");let e=await v.zQ.getSettings();s(e)}catch(s){let e=s instanceof Error?s.message:"Failed to load settings";g(e),l.oR.error(e)}finally{i(!1)}},Z=async()=>{try{p(!0),g("");let r=await v.zQ.updateSettings(e);s(r),l.oR.success("Settings saved successfully")}catch(s){let e=s instanceof Error?s.message:"Failed to save settings";g(e),l.oR.error(e)}finally{p(!1)}},J=async()=>{try{if(B(!0),E(""),R.new_password!==R.confirm_password)return void E("New passwords do not match");if(R.new_password.length<6)return void E("New password must be at least 6 characters");let{apiClient:e}=await Promise.resolve().then(r.bind(r,7916));await e.patch("/admin/api/password",{current_password:R.current_password,new_password:R.new_password}),F({current_password:"",new_password:"",confirm_password:""}),l.oR.success("Password updated successfully")}catch(s){let e=s instanceof Error?s.message:"Failed to update password";E(e),l.oR.error(e)}finally{B(!1)}},U=(e,r)=>{s(s=>({...s,[e]:r}))},$=e=>{s(s=>{var r;return{...s,cashu_mints:(null==(r=s.cashu_mints)?void 0:r.filter((s,r)=>r!==e))||[]}})},z=(s,r,t)=>{let n=e[s]||"";return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:s,children:r}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.p,{id:s,type:C?"text":"password",value:C?n:n?"••••••••":"",onChange:e=>U(s,e.target.value),placeholder:t,className:"flex-1"}),(0,a.jsx)(u.$,{type:"button",variant:"outline",size:"icon",onClick:()=>_(!C),children:C?(0,a.jsx)(w.A,{className:"h-4 w-4"}):(0,a.jsx)(b.A,{className:"h-4 w-4"})})]})]})};return n?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading settings..."})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:"Admin Settings"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Configure your Routstr node settings"})]}),m&&(0,a.jsxs)(j.Fc,{variant:"destructive",className:"mb-6",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),(0,a.jsx)(j.TN,{children:m})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Basic Information"}),(0,a.jsx)(c.BT,{children:"Configure the basic node information and branding"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"name",children:"Node Name"}),(0,a.jsx)(o.p,{id:"name",value:e.name||"",onChange:e=>U("name",e.target.value),placeholder:"ARoutstrNode"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(f.T,{id:"description",value:e.description||"",onChange:e=>U("description",e.target.value),placeholder:"A Routstr Node",rows:3})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"http_url",children:"HTTP URL"}),(0,a.jsx)(o.p,{id:"http_url",value:e.http_url||"",onChange:e=>U("http_url",e.target.value),placeholder:"https://your-node.com"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"onion_url",children:"Onion URL (Optional)"}),(0,a.jsx)(o.p,{id:"onion_url",value:e.onion_url||"",onChange:e=>U("onion_url",e.target.value),placeholder:"http://your-node.onion"})]})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Nostr Configuration"}),(0,a.jsx)(c.BT,{children:"Configure Nostr public and private keys"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"npub",children:"Public Key (npub)"}),(0,a.jsx)(o.p,{id:"npub",value:e.npub||"",onChange:e=>U("npub",e.target.value),placeholder:"npub1..."})]}),z("nsec","Private Key (nsec)","nsec1...")]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Security Settings"}),(0,a.jsx)(c.BT,{children:"Configure authentication and API access"})]}),(0,a.jsx)(c.Wu,{className:"space-y-4",children:z("upstream_api_key","Upstream API Key","Enter API key")})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Cashu Mints"}),(0,a.jsx)(c.BT,{children:"Configure Cashu mint endpoints for payments"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"newMint",children:"Add Mint URL"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.p,{id:"newMint",value:S,onChange:e=>k(e.target.value),placeholder:"https://mint.example.com"}),(0,a.jsx)(u.$,{onClick:()=>{S.trim()&&(s(e=>({...e,cashu_mints:[...e.cashu_mints||[],S.trim()]})),k(""))},disabled:!S.trim(),children:"Add Mint"})]})]}),e.cashu_mints&&e.cashu_mints.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{children:"Configured Mints"}),(0,a.jsx)("div",{className:"space-y-2",children:e.cashu_mints.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 rounded border p-2",children:[(0,a.jsx)("span",{className:"flex-1 text-sm",children:e}),(0,a.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>$(s),children:"Remove"})]},s))})]})]})]}),(0,a.jsx)(c.Zp,{className:"mt-6",children:(0,a.jsxs)(c.wL,{className:"flex justify-between",children:[(0,a.jsxs)(u.$,{variant:"outline",onClick:T,disabled:n||x,children:[(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Reload"]}),(0,a.jsxs)(u.$,{onClick:Z,disabled:n||x,children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),x?"Saving...":"Save Settings"]})]})}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Change Admin Password"}),(0,a.jsx)(c.BT,{children:"Update your admin password for enhanced security"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[A&&(0,a.jsxs)(j.Fc,{variant:"destructive",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),(0,a.jsx)(j.TN,{children:A})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"current_password",children:"Current Password"}),(0,a.jsx)(o.p,{id:"current_password",type:"password",value:R.current_password,onChange:e=>F(s=>({...s,current_password:e.target.value})),placeholder:"Enter current password"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"new_password",children:"New Password"}),(0,a.jsx)(o.p,{id:"new_password",type:"password",value:R.new_password,onChange:e=>F(s=>({...s,new_password:e.target.value})),placeholder:"Enter new password (min 6 characters)"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"confirm_password",children:"Confirm New Password"}),(0,a.jsx)(o.p,{id:"confirm_password",type:"password",value:R.confirm_password,onChange:e=>F(s=>({...s,confirm_password:e.target.value})),placeholder:"Confirm new password"})]})]}),(0,a.jsx)(c.wL,{children:(0,a.jsxs)(u.$,{onClick:J,disabled:P||!R.current_password||!R.new_password||!R.confirm_password,children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),P?"Updating...":"Update Password"]})})]})]})]})}var _=r(532),S=r(7569),k=r(953);function R(){return(0,a.jsxs)(k.SidebarProvider,{children:[(0,a.jsx)(S.AppSidebar,{variant:"inset"}),(0,a.jsxs)(k.SidebarInset,{children:[(0,a.jsx)(_.SiteHeader,{}),(0,a.jsx)("div",{className:"flex flex-1 flex-col",children:(0,a.jsxs)("div",{className:"@container/main flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Settings"})}),(0,a.jsxs)(n.tU,{defaultValue:"admin",className:"w-full",children:[(0,a.jsx)(n.j7,{className:"mb-4",children:(0,a.jsx)(n.Xi,{value:"admin",children:"Admin Settings"})}),(0,a.jsx)(n.av,{value:"server",children:(0,a.jsx)(g,{})}),(0,a.jsx)(n.av,{value:"admin",children:(0,a.jsx)(C,{})})]})]})})]}),(0,a.jsx)(l.l$,{})]})}},6839:(e,s,r)=>{"use strict";r.d(s,{Xi:()=>c,av:()=>o,j7:()=>l,tU:()=>i});var a=r(3422);r(4398);var t=r(1749),n=r(9183);function i(e){let{className:s,...r}=e;return(0,a.jsx)(t.bL,{"data-slot":"tabs",className:(0,n.cn)("flex flex-col gap-2",s),...r})}function l(e){let{className:s,...r}=e;return(0,a.jsx)(t.B8,{"data-slot":"tabs-list",className:(0,n.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...r})}function c(e){let{className:s,...r}=e;return(0,a.jsx)(t.l9,{"data-slot":"tabs-trigger",className:(0,n.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}function o(e){let{className:s,...r}=e;return(0,a.jsx)(t.UC,{"data-slot":"tabs-content",className:(0,n.cn)("flex-1 outline-none",s),...r})}},8561:(e,s,r)=>{"use strict";r.d(s,{E:()=>l});var a=r(3422);r(4398);var t=r(4676),n=r(9183);let i=(0,t.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-500/80",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-500/80",error:"border-transparent bg-red-500 text-white hover:bg-red-500/80"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:r,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:r}),s),...t})}},9442:(e,s,r)=>{"use strict";r.d(s,{Fc:()=>l,TN:()=>c});var a=r(3422);r(4398);var t=r(4676),n=r(9183);let i=(0,t.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(i({variant:r}),s),...t})}function c(e){let{className:s,...r}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...r})}}},e=>{var s=s=>e(e.s=s);e.O(0,[363,222,226,978,651,900,601,945,497,358],()=>s(2739)),_N_E=e.O()}]);